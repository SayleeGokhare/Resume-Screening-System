{% extends 'base.html' %}

{% block content %}
<div class="container mx-auto mt-10">
    <div class="glass p-8 rounded-lg shadow-lg">
        <h1 class="text-4xl font-bold mb-4">Dashboard</h1>
        <p class="text-xl mb-8">Welcome, {{ user.username }}! You are logged in as a <span
                class="font-bold text-yellow-300">{{ user.role|title }}</span>.</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {% if user.role == 'recruiter' %}
            <div class="col-span-1 md:col-span-2 space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-white">Your Posted Jobs</h2>
                    <a href="{% url 'create_job' %}"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition">Post
                        New Job</a>
                </div>

                <div class="grid gap-4">
                    {% for job in jobs %}
                    <div class="glass p-6 rounded-xl flex justify-between items-center transition hover:bg-white/5">
                        <div>
                            <h3 class="text-xl font-bold text-white">{{ job.title }}</h3>
                            <p class="text-gray-400 text-sm">Posted on {{ job.id }}</p>
                        </div>
                        <div class="flex space-x-3">
                            <a href="{% url 'ranking' job.id %}"
                                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                                View Candidates
                            </a>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-gray-400">You haven't posted any jobs yet.</p>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <!-- Candidate Dashboard -->
            <div class="space-y-6">
                <!-- Resume Section -->
                <div class="glass p-6 rounded-xl">
                    <h2 class="text-2xl font-bold text-white mb-4">My Resume</h2>
                    {% if resume %}
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-green-400 font-medium mb-1">Resume Uploaded âœ“</p>
                            <p class="text-sm text-gray-400 mb-2">File: {{ resume.file.name }}</p>
                            <div class="mb-2">
                                <p class="text-xs text-gray-400 mb-1">Skills Detected:</p>
                                <div class="flex flex-wrap gap-1">
                                    {% if resume.skills %}
                                    {% for skill in resume.skills.split|slice:"," %}
                                    <!-- Note: simple split might not work well if comma separated in string -->
                                    <!-- Better to just output the string if it's already comma separated? -->
                                    <!-- Django template doesn't have split. We can use a custom tag or just styling -->
                                    {% endfor %}
                                    <!-- Let's try a simpler approach since we store it as a comma separated string -->
                                    <!-- We can just display it nicely or better yet, let's treat it as a string for now 
                                             but style it to look like a list if possible? 
                                             Actually, let's just use the string but maybe use a custom filter or just JS?
                                             Wait, earlier in ranking.html we iterated over a list. 
                                             Here resume.skills is a TEXTField (string). 
                                             Let's just display the text cleanly for now to be safe, 
                                             or use a simple split if we are sure. 
                                             
                                             Let's sticking to the string but style it better.
                                        -->
                                    <p class="text-white text-sm bg-white/5 p-2 rounded-lg">{{ resume.skills }}</p>
                                    {% else %}
                                    <span class="text-gray-500 italic">None extracted</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col space-y-2">
                            <a href="{{ resume.file.url }}" target="_blank"
                                class="text-blue-400 hover:text-blue-300 text-sm underline">View File</a>
                            <a href="{% url 'upload_resume' %}"
                                class="text-yellow-400 hover:text-yellow-300 text-sm underline">Update Resume</a>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center py-6">
                        <p class="text-gray-300 mb-4">You haven't uploaded a resume yet.</p>
                        <a href="{% url 'upload_resume' %}"
                            class="inline-block bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition">Upload
                            Resume Now</a>
                    </div>
                    {% endif %}
                </div>

                <!-- Applications Section -->
                <div class="glass p-6 rounded-xl">
                    <h2 class="text-2xl font-bold text-white mb-4">My Applications</h2>
                    <ul class="space-y-3">
                        {% for app in applications %}
                        <li class="flex justify-between items-center border-b border-gray-700 pb-2">
                            <span class="text-white font-medium">{{ app.job.title }}</span>
                            <span class="text-xs text-gray-400">Applied</span>
                        </li>
                        {% empty %}
                        <li class="text-gray-400">No active applications.</li>
                        {% endfor %}
                    </ul>
                    <div class="mt-4 pt-2">
                        <a href="{% url 'job_list' %}"
                            class="block w-full text-center bg-white/10 hover:bg-white/20 text-white py-2 rounded-lg transition">Browse
                            Jobs</a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}